# Template file for 'mindustry'
pkgname=mindustry
version=97
revision=1
archs=noarch
wrksrc=Mindustry-${version}
hostmakedepends="openjdk8 gradle libicns"
depends="virtual?java-runtime"
short_desc="Sandbox tower-defense game"
maintainer="teldra <teldra@rotce.de>"
license="GPL-3.0-or-later"
homepage="https://mindustrygame.github.io/"
distfiles="https://github.com/Anuken/Mindustry/archive/v${version}.tar.gz"
checksum=8acdbcba19a4e4470b6a74ab5c0704dcf64b712e0ded0102e44060093835180e

do_build() {
	./gradlew --no-daemon dist -Pbuildversion="${version}"
	cd core/assets/icons
	/usr/bin/icns2png --extract icon.icns
}

do_install() {
	vmkdir usr/share/mindustry
	vinstall desktop/build/libs/Mindustry.jar 644 usr/share/mindustry
	vbin ${FILESDIR}/mindustry
	vinstall ${FILESDIR}/mindustry.desktop 644 usr/share/applications
	local icon_size; for icon_size in 256 512 1024; do
		vmkdir usr/share/icons/hicolor/${icon_size}x${icon_size}/apps
		vinstall "core/assets/icons/icon_${icon_size}x${icon_size}x32.png" 644 \
		"usr/share/icons/hicolor/${icon_size}x${icon_size}/apps/${pkgname}.png"
	done
}

mindustry-server_package() {
	short_desc+=" - Server"
	pkg_install() {
		vmkdir usr/share/mindustry
		vinstall server/build/libs/server-release.jar 644 usr/share/mindustry
		vinstall ${FILESDIR}/mindustry-server.desktop 644 usr/share/applications
		vbin ${FILESDIR}/mindustry-server
	}
}
